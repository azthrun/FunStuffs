module WebRequestHelper
  
  TEXTHEADER = {:headers => {"Content-type" => "text/plain"}}
  JSONHEADER = {:headers => {"Accept" => "application/json;"}}
    
  ETHOSDISTRO = "ethosdistro.com/?json=yes"

  #TODO: Test IDs: b57258, 8d2305
  
  def hasNetwork
    response = Rho::Network.get({:url => "http://www.google.com"}).merge(TEXTHEADER)
    ret = response["status"].eql?("ok") ? true : false
    ret
  end
  
  def downloadRigStatus
    if hasNetwork
      requestUrl = "http://#{Settings.panelId}.#{ETHOSDISTRO}"
      response = Rho::Network.get({:url => requestUrl}).merge(JSONHEADER)

      if response["status"].eql?("ok")
        # Analyze Data
        if response["body"].empty?
          # Panel ID has no live rig
        else
          storeRigStatus(response["body"])
        end
      else
        # GET Request Error
        
      end
    else
      # No Internet Access
      
    end
  end
  
  def storeRigStatus(data)
    feed = Rho::JSON.parse(data)
    
    # Panel overall data
    
    
    # Miner data
    rigs = feed["rigs"]
    Miner.storeMinerStatus(rigs)
  end
  
end