<div data-role="page" class="page">
  
  <!-- header -->
  <div class="worker-header">
    <span onClick="backgroundPage('/app/Settings/showLogs');">Panel Information</span>
  </div>
  <div class="header-left-button" style="background:transparent url('/public/images/iconBack.svg') no-repeat center center;background-size:contain;" onClick="replacePage('/app/Settings/wait?mode=config');"></div>
  <div class="header-right-button" style="background:transparent url('/public/images/iconSettings.svg') no-repeat center center;background-size:contain;" onClick="showInfoPopup();"></div>
  
  <!-- content -->
  <div data-role="content">
  
    <!-- worker slides -->
    <div class="worker-slides" style="display;none;">
      <% @workers.each_with_index do |worker, idx| %>
        <% themeColor = idx % 2 != 1 ? "777696" : "d66a00" %>
        <div>
          <div class="worker-slides-content" style="border:1px solid #<%= themeColor %>;">
            <div class="worker-slides-header" style="background-color:#<%= themeColor %>;">
              <p style="color:#ffffff;">Worker <strong><%= worker.object %></strong> (IP: <strong><%= worker.rigIpAddress %></strong>)</p>
            </div>
            <div style="padding:.2em .5em;">
              <div class="wrapped-panel">
                <div style="margin:0;padding:0;">Worker Hash: <%= worker.totalHash %> Mh/s</div>
                <div style="margin:0;padding:0;">Live GPUs: <%= worker.minerInstance %>/<%= worker.numOfGPU %> <%= (worker.minerInstance.to_i / worker.numOfGPU.to_i * 100).to_i %>%</div>
              </div>
              <input type="button" value="&#8611; General Statuses &#8610;" class="button-standard button-mini" onClick="showWorkerPopup('<%= worker.object %>');" />
              <div class="gpus-panel">
                <% (0..(worker.numOfGPU.to_i - 1)).each do |index| %>
                  <%
                    gpuBoxColor = Miner.getGPUBoxColor(index)
                    gpuHash = worker.minerHashes.split(" ")[index]
                    gpuTemp = worker.gpuTemp.split(" ")[index]
                    gpuInfo = worker.gpusInfo.split("\n")[index]
                    gpuRam = worker.gpusRam.split(" ")[index]
                    gpuPTune = worker.gpuPTune.split(" ")[index]
                    gpuVolt = worker.gpuVoltage.split(" ")[index]
                    gpuWatt = worker.gpuWatt.split(" ")[index]
                    gpuFanRPM = worker.gpuFanRPM.split(" ")[index]
                    gpuCor = worker.gpuCore.split(" ")[index]
                    gpuMem = worker.gpuMem.split(" ")[index]
                  %>
                  <div class="gpu-item-box" style="background-color:#<%= gpuBoxColor %>;">
                    <p>
                      <span style="line-height:1.2em;font-size:1.2em;font-weight:700;"><%= gpuInfo[0..3] %></span>
                      <span style="line-height:1.2em;font-size:.7em;">&nbsp;(<%= worker.miner %>; ethOS <span <% if worker.osVersion != @panel["current_version"] %>style="color:#880000;font-weight:700;"<% end %>><%= worker.osVersion %></span>)</span>
                    </p>
                    <span class="gpu-info-btn" onClick="showGPUPopup('<%= gpuInfo %>');"></span>
                    <div class="horizontal-scroll-panel">
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuHash.split(".").first %></span><% if gpuHash.include?(".") %>.<%= gpuHash.split(".").last %><% end %></p>
                        <p style="margin:0;padding:0;font-style:italic;">Mh/s</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuTemp.split(".").first %></span><% if gpuTemp.include?(".") %>.<%= gpuTemp.split(".").last %><% end %></p>
                        <p style="margin:0;padding:0;font-style:italic;">&#8451;</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuWatt %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">watts</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuVolt.split(".").first %></span><% if gpuVolt.include?(".") %>.<%= gpuVolt.split(".").last %><% end %></p>
                        <p style="margin:0;padding:0;font-style:italic;">volts</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuFanRPM %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">rpm</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuCor %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">Hz</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuMem %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">Hz</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuPTune %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">pTune</p>
                      </div>
                      <div class="panel-item">
                        <p style="margin:0;padding:0;"><span style="font-size:1.5em;font-weight:700;"><%= gpuRam %></span></p>
                        <p style="margin:0;padding:0;font-style:italic;">GB RAM</p>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
      
    <!-- info popup -->
    <div id="info-popup-background" class="popup-background" onClick="hideInfoPopup();"></div>
    <div id="info-popup" class="popup-content">
      <div class="popup-header">Panel <%= Settings.panelId %></div>
      <div class="grid-layout">
        <span class="two-columns-grid left">Total Hash:</span>
        <span class="two-columns-grid right"><%= @panel["total_hash"] %> Mh/s</span>
      </div>
      <div class="grid-layout">
        <span class="two-columns-grid left">AVG Temperature:</span>
        <span class="two-columns-grid right"><%= @panel["avg_temp"] %> &#8451;</span>
      </div>
      <div class="grid-layout">
        <span class="two-columns-grid left">Rig Status:</span>
        <span class="two-columns-grid right"><span <% if @panel["alive_rigs"] != @panel["total_rigs"] %>style="font-weight:700;color:#880000;"<% end %>><%= @panel["alive_rigs"] %></span> live out of <%= @panel["total_rigs"] %></span>
      </div>
      <div class="grid-layout">
        <span class="two-columns-grid left">GPU Status:</span>
        <span class="two-columns-grid right"><span <% if @panel["alive_gpus"] != @panel["total_gpus"] %>style="font-weight:700;color:#880000;"<% end %>><%= @panel["alive_gpus"] %></span> live out of <%= @panel["total_gpus"] %></span>
      </div>
      <div class="grid-layout">
        <span class="two-columns-grid left">Panel Last Refreshed:</span>
        <span class="two-columns-grid right"><%= Time.at(@panel["per_info"]["claymore"]["current_time"]).strftime("%y-%^b-%d %I:%M:%S %p") %></span>
      </div>
    </div>

    <!-- worker popup -->
    <div id="worker-popup-background" class="popup-background" onClick="hideWorkerPopup();"></div>
    <div id="worker-popup" class="popup-content">
      
    </div>
    
    <!-- gpu popup -->
    <div id="gpu-popup-background" class="popup-background" onClick="hideGPUPopup();"></div>
    <div id="gpu-popup" class="popup-content">
      <p></p>
    </div>
    
  </div>
  
  <script>
    $(document).ready(function() {
      <% if @workers.count >= 2 %>
        $(".worker-slides").slick({
          infinite: true,
          arrows: false,
          centerMode: true,
          adaptiveHeight: true,
          slidesToShow: 1,
          slidesToScroll: 1
        });
      <% end %>
      
      $(".worker-slides").fadeIn(500);
    });
  </script>
</div>